# ネットワークについて調べる

# NATとは

NATとはNetwork Address Translationの略称である。グローバルIPアドレスとプライベートIPアドレスを変換する技術のことを指す。NATが誕生した背景としてIPv4の枯渇問題がある。
NATにはSource NATとDestination NATの二種類が存在する。

## Source NAT

Source NAT(別称：SNAT)とは、プライベートネットワークから外部へ通信を行う際にIPアドレスを変換(プライベートIP→グローバルIP)する技術のことである。

## Destination NAT

Destination NAT(別称：DNAT)とは、グローバルネットワークからプライベートネットワークへ通信を行う際にIPアドレスを変換(グローバルIP→プライベートIP)する技術のことである。

# ソケット通信とは

## ソケットとは

ソケット(socket)とは、受け口、軸受けなどといった意味を持つ。ソフトウェアの領域においては、クライアントサーバモデルにおける通信のインターフェースのことである。
ソケット通信を理解するに当たって次の３つの知識の理解が前提である。

- TCP/IPモデルポート番号

    TCP/IPモデルとは、インターネットにおける標準的なプロトコルスタックである。
    プロトコルとは、データを通信する上での規約のことであり、プロトコルスタックとは、コンピュータが通信するために必要なプロトコル階層のことである。

- クライアントサーバモデル

    クライアントサーバモデルとは、ソフトウェアアーキテクチャのひとつである。
    カプセル化・非カプセル化とは

- APIインターフェース

    APIとはApplication Programing Interfaceの略称である。インターフェースとは、異なる２つの媒体を接続する境界線又は接点という意味である。ここには、ライブラリやフレームワークの関数、プログラミング言語の組み込み関数もインターフェースに含まれることになる。


## ソケット通信とは

ソケットを用いた通信のことであり、TCP/IPモデルでいうとトランスポート層にあたる。つまり、アプリケーション層→ソケットAPI→トランスポート層の構成になり、ソケットAPIを用いることでトランスポート層より下は抽象化される。

# TCP/IPモデルについて

TCP/IPモデルは４つの階層からなるプロトコルスタックを持つ。

| 階層 | TCP/IPプロトコルスタック | プロトコル | 役割 |
| --- | --- | --- | --- |
| 4 | アプリケーション層 | HTTP,DNS… | ユーザが使うアプリケーションが通信する際のプロトコルを定める |
| 3 | トランスポート層 | TCP,UDP…. | 通信の信頼性について定義する |
| 2 | ネットワーク層 | IPv4, IPv6… | ネットワーク上のコンピュータを識別するためにIPアドレスを指定する。 |
| 1 | ネットワークインターフェース層 | Ethernet, Wi-Fi… | 隣接するコンピュータ間の通信を可能にする。上位層から送られてきたビットを電気信号・光信号・無線に変換する |

## TCP/UDPの違いについて

TCP/UDPの違いには主に信頼性・速さがあり、次のような特徴がある。

| プロトコル | 信頼性 | 速さ | 特徴 | 利用例 |
| --- | --- | --- | --- | --- |
| TCP | ◯ | △ | 送信路の確立、データの再送制御をする。ハンドシェイクと呼ばれる接続のテストを行い、会話的に通信するため信頼性が高く、完全なデータが求められる場合に用いられる。 | HTTP, SMTP, FTP, SSH |
| UDP | △ | ◯ | 送信路の確立、データの再送制御を行わない。一方的に通信するため信頼性は低いが、データ量が少なく、即時性が求められる場合に用いられる。 | DNS, NTP, TFTP, SNMP |

# OSI参照モデルについて

OSI(Open System Interconnection)参照モデルとは、ISOが定めたコンピュータの通信プロトコルの分類モデルである。
OSI参照モデルに準拠すると、次のような７種類の層に分類される。

| 層 | 名称 | 説明 | 利用例 |
| --- | --- | --- | --- |
| ７ | アプリケーション層 | ユーザとの直接的な操作やソフトウェアの機能に関しての手続きやデータ形式・プロトコルを管理 | HTTP, DNS… |
| ６ | プレゼンテーション層 | データを送信先の対応形式に変換、暗号化を管理 | SMTP, FTP… |
| ５ | セッション層 | セッションの開始→維持→終了を管理 | SSL, TSL… |
| ４ | トランスポート層 | 通信データの品質やエラー処理を管理 | TCP, UDP… |
| ３ | ネットワーク層 | ネットワーク全体での体系的なアドレス割りやルーティング、転送を管理 | ICMP, IP… |
| 2 | データリンク層 | 隣接するノード間の通信等のネットワークの物理的接続と、フレームの生成を管理 | Ethernet, CAN… |
| １ | 物理層 | ビットの転送とネットワークメディアの特性を管理 | IEEE, ISDN… |

## OSI参照モデル階層とTCP/IP階層の差分

| OSI参照モデル | TCP/IP |
| --- | --- |
| アプリケーション層 | アプリケーション層 |
| プレゼンテーション層 | ↓ |
| セッション層 | ↓ |
| トランスポート層 | トランスポート層 |
| ネットワーク層 | ネットワーク層 |
| データリンク層 | ネットワークインターフェース層 |
| 物理層 | ↓ |

# IPアドレス

IPアドレス(Internet Protocol Address)とは通信の相手先を識別する番号のことを指す。２進数の数字の羅列で、IPアドレスには、ネットワークについての情報と、ホスト(端末)についての２つの情報が組み込まれている。現在、IPアドレスにはversion4のIPv4と、version6のIPv6の二種類がある。

|  | IPv4 | IPv6 |
| --- | --- | --- |
| 範囲 | 32bit | 128bit |
| 最大個数 | 約43億 | 約340潤 |
| 表記方法 | 10進数 | 16進数 |

IPv4は枯渇問題に陥っているが、v4とv6の仕様が異なるため移行が滞っているのが現状である。
そのため、応急処置として以下のような対策がとられる

- IPアドレスを用途別で分ける（グローバルIP・プライベートIP)

    グローバルIPアドレスを外部とは通信しない、企業内のみの通信に使用する企業が増加し、IPアドレスが枯渇してしまった背景がある。この解消のため、同じLAN内であれば直接通信が可能なプライベートIPアドレスが誕生した。そして、従来のIPアドレスをグローバルIPアドレスと呼ぶようになる。

    | IPアドレス種別 | 概要 | 通信目的 | 通信機器 | ネットワーク |
    | --- | --- | --- | --- | --- |
    | グローバルIPアドレス | インターネットに接続できるIP。世界で一意の値。 | 外部との通信 | サーバとルータの相互通信 | WAN |
    | プライベートIPアドレス | 同じ範囲内(家庭・会社)のみ通信できるIP。グローバルIPのように一意の値を持つが、異なるLANであれば重複は問題ない。 | 内部の通信 | ルータとPC・スマホ等の相互通信 | LAN |

    ### プライベートIPアドレスで外部と接続できるのは何故か

    プライベートIPアドレスが振り分けられる家庭内のPCやスマホからインターネットに接続できるのは、ルータが自動的にグローバルIPアドレスとプライベートIPアドレスの変換とサブネットマスクへの決定を行っているからである。

- IPアドレスをユーザの規模別で分ける(クラスレスアドレッシング)

    CIDR(クラスレスアドレッシング)とは、IPアドレス空間全体をアドレスクラスに分類し、利用するユーザの規模数に応じてIPアドレスを割り当てる仕組みである。
    割り当てはA~D(内A~Cがユーザ対象)まであり、クラスが下にいくほど規模数が小さくなる。一般家庭などは基本的にクラスCにあたる192.0.0.0~のIPアドレス帯である。
    しかし、クラスフルアドレッシングにはユーザに当てられるアドレスクラスが３つしかないかつ、それもユーザにとって「ちょうどよいアドレスクラス」ではなかった。そのため、３種類の中ではちょうどよいクラスBにアクセスが集中し、結果としてIPの枯渇問題は解消することはできてはいない。
    この状況を解消すべく、サブネット・サブネットマスクという概念が誕生することになる。


## サブネット

サブネット又はサブネット化とは、一つの大きなネットワークを分割し、小さなネットワークの集合にすることである。

# サブネットマスク

サブネットマスクとはサブネット化(ネットワークの分割)を行ったIPアドレスのうち、どこまでがネットワークアドレスで、どこまでがコンピュータ端末を表すホストアドレス部分か識別するために使用する数値のことである。２進数に変換し、”1”の部分がネットワークで、”0”の部分がホストアドレスと読み取る。
一般的には、255.255.255.0のような10進数とピリオドで表す。これを２進数に変換し、IPアドレス(例：10101100…)とサブネットマスク(11111111…)の論理積を取る。

# ARPとRARPとは

IPアドレスとMACアドレスの相互変換が必要な場面でARPとRARPが役立っている。

## ARP

ARPとはAddress Resolution Protocolの略称である。ネットワーク上でデバイスが持つIPアドレスをMACアドレスに変換するためのプロトコルであり、ARPによってデータの宛先が特定され正確に通信を行うことができる。

## RARP

RARPとはReverse Address Resolution Protocolの略称である。MACアドレスからIPアドレスを取得するためのプロトコルである。

## ARPとRARPの相違点

|  | アドレス解決の方向性 | 使用用途 | 変遷と現在 |
| --- | --- | --- | --- |
| ARP | IPアドレスからMACアドレスを取得するプロセスの担当。 | ネットワーク通信の際に、IPアドレスを知っているが、MACアドレスを知らない場面で使用 | 現在もアクティブに使用されている。ローカルネットワーク上の通信において中心的な役割を果たす |
| RARP | MACアドレスからIPアドレスを取得するプロセスを担当。 | MACアドレスは知っているが、自身のIPアドレスを知らない場面で使用　| 現在はあまり使用されておらず、上位互換のプロトコルであるDHCPが代用される。
